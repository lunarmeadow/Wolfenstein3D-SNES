# Wolfenstein3D-SNES
Reconstructing the Wolfenstein 3D codebase for the SNES from the released source code of SNA3D

## Compiling

To compile the game, you will need a copy of WDCTools from https://wdc65xx.com/WDCTools. This is a toolsuite developed by the current manufacturer of 6502-family CPUs, but the important part is that the compiler, assembler, and linker included are directly based on the Zardoz toolsuite that ID used to develop Wolfenstein 3D on the SNES back in the 90's. This means that the code is fully compatible, and in fact may be slightly more optimized, while running on a modern Windows machine without a VM. The biggest hitch in compiling the game is reconfiguring the build process and makefile, and skimming the source code for errors during compile, and slowly ironing them out.

## Building a functional ROM

The .BIN file produced by WDCTools' linker binary output is an incomplete ROM, which is missing a significant chunk of data. There are 4 .BIN files which need to be put in the ROM at different pre-defined hex offsets. Sometimes, runaway code or data from the compiler can overwrite this area, which may represent a challenge to fitting them in. Nonetheless, a stock SNA3D rom is padded with 00 bytes across the entire relevant range. You may insert these files with a hex editor by copying and paste-writing at the given offsets, but make sure you overwrite the existing 00 bytes, don't just paste it as new data. On Windows, I highly suggest HxD for this task. Once you have built WOLF.BIN, you will want to place the contents of DEMO1.BIN at 0xE000, DEMO2.BIN at 0xF000, SCALERS.BIN at 0x10000, and EXTDATA.BIN at 0x20000. When building with ID_VERSION defined, code tends to overrun 0xE000. You can possibly solve this by optimizing compiler flags, such as using -SOP in place of -SO, which runs the peephole optimizer in addition to enabling all the "general-purpose" optimizations. DEMO1 and DEMO2's hex offsets are also determined by a simple #DEFINE preprocessor directive, so can be re-allocated at a spot that has roughly 0x1000 bytes of 0x00 padding per demo. This technique generates a fully functional SNA3D rom if you compile from the original state of the codebase. Then, if you rebuild EXTDATA and reconstruct the original Wolfenstein 3D data with something like SNES Wolf3D Extractor, renaming actor classes to match their states, converting the .WAV to .VOC and then to .SNS, same with the Wolfenstein 3D Macintosh MIDI files, which directly correspond to the SNES MIDI files. Graphics can also be brought back by editing the sprite sheets and overlaying the extracted .PNGs on them, and then converting them back and ensuring they're in the correct indexed colour palette. The maps can theoretically be built from the tools provided, although some have allegedly ripped the .CHM files from a retail Wolfenstein 3D ROM. These represent the major challenges towards recovering the Wolfenstein 3D codebase and assets from the SNA3D leak, and the solutions towards building a functional ROM. Writing scripts to streamline some of these processes would be very useful, especially the binary blob insertion.
